Amplify {
Secret
IOT_ENDPOINT_URL = aplwx973aujgp-ats.iot.eu-central-1.amazonaws.com

Env Var
ADD_DEVICE_ENDPOINT = https://fuqcg5ljae.execute-api.eu-central-1.amazonaws.com/AddDevice/amplify-d1oceu7bffyxdg-ma-createDeviceFunctionlamb-oG9vHtl2RenF
}

{
  "Origin": "https://main.d1oceu7bffyxdg.amplifyapp.com",
  "Access-Control-Request-Method": "POST",
  "Access-Control-Request-Headers": "authorization, content-type"
}


services need to start in this order:
1. auth/cognito
2. dynamoDB
3.iotCore - need arn/name from dynamoDB
4.createDevice - need arn from IotCore
5.fetchDevices - need arn/name from dynamoDB
6.apiGateway - need arn/name from createDevice, fetchDevices, and auth/cognito


AKIA47GB7VXYF46SVHDJ

9MyX8naxeRUsHnzWrsudhb7bW7HagdMBW91uL8Mp


ownerID: 550e8400-e29b-41d4-a716-446655440000


CreateDeviceLambda_To_IotCore - policy:
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "iot:CreateThing",
                "iot:AttachThingPrincipal",
                "iot:UpdateThingShadow"
            ],
            "Resource": "arn:aws:iot:eu-central-1:891612540400:thing/*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "iot:AttachThingPrincipal"
            ],
            "Resource": "arn:aws:iot:eu-central-1:891612540400:cert/*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "iot:DescribeEndpoint",
                "iot:CreateKeysAndCertificate"
            ],
            "Resource": "*"
        }
    ]
}


message route rules iot core:
SELECT *, clientid() AS DeviceId, timestamp() AS Timestamp FROM '+/telemetry'


secrets:
DEVICE_TABLE_NAME
IOT_CORE_ENDPOINT
WEB_APP_URL
CREATE_DEVICE_LAMBDA_ARN
FETCH_DEVICES_LAMBDA_ARN
COGNITO_ISSUER_URL
COGNITO_APP_CLIENT_ID
AWS_APP_ID

bash for default secrets{
aws secretsmanager create-secret --name DEVICE_TABLE_NAME --secret-string "PLACEHOLDER_TABLE_NAME"
aws secretsmanager create-secret --name IOT_CORE_ENDPOINT --secret-string "PLACEHOLDER_IOT_ENDPOINT"
aws secretsmanager create-secret --name WEB_APP_URL --secret-string "PLACEHOLDER_WEB_APP_URL"
aws secretsmanager create-secret --name CREATE_DEVICE_LAMBDA_ARN --secret-string "PLACEHOLDER_LAMBDA_ARN"
aws secretsmanager create-secret --name FETCH_DEVICES_LAMBDA_ARN --secret-string "PLACEHOLDER_LAMBDA_ARN"
aws secretsmanager create-secret --name COGNITO_ISSUER_URL --secret-string "PLACEHOLDER_COGNITO_ISSUER_URL"
aws secretsmanager create-secret --name COGNITO_APP_CLIENT_ID --secret-string "PLACEHOLDER_COGNITO_APP_CLIENT_ID"
aws secretsmanager create-secret --name AWS_APP_ID --secret-string "PLACEHOLDER_APP_ID"

}

issuer: https://cognito-idp.eu-central-1.amazonaws.com/eu-central-1_8CahOmFtu

audience: 607439gcflutsmha0cfd3vri08

https://main.d1oceu7bffyxdg.amplifyapp.com


we need to setup another DB table aswell... containing, deviceID, ownerID, deviceAlias, triggerLimits(device min and max value for my messageboard)

fetchDeviceData: https://6zqrep9in8.execute-api.eu-central-1.amazonaws.com

import 'package:amplify_auth_cognito/amplify_auth_cognito.dart';

iot policy arn:
arn:aws:iot:eu-central-1:891612540400:policy/DevicePolicy